(this.webpackJsonpmetar_map=this.webpackJsonpmetar_map||[]).push([[0],{10:function(e,t,a){},24:function(e,t,a){e.exports=a(35)},29:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(21),i=a.n(s),c=(a(29),a(1)),o=a(3),l=a(2),p=a(15),u=a(4),m=(a(10),a(5)),d=function(e){function t(){return Object(c.a)(this,t),Object(o.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"tile is-ancenstor"},r.a.createElement("div",{className:"tile is-parent is-12",style:{marginTop:"0px",paddingTop:"0px"}},r.a.createElement("div",{className:"tile is-child"},r.a.createElement("div",{className:"has-text-centered is-size-4"},this.props.current_time.toUTCString()))))}}]),t}(r.a.Component),h=function(e){function t(){return Object(c.a)(this,t),Object(o.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"tile is-ancestor"},this.props.children)}}]),t}(r.a.Component),f=function(e){function t(){return Object(c.a)(this,t),Object(o.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=[],t=Date.now();return this.props.metar.wind_speed_kt&&this.props.metar.wind_speed_kt._text>20&&e.push(r.a.createElement("i",{key:t,className:"fas fa-exclamation-triangle"})),this.props.metar.wind_gust_kt&&this.props.metar.wind_gust_kt._text>20&&e.push(r.a.createElement("i",{key:t+1,className:"fas fa-exclamation-triangle"})),this.props.metar.wind_gust_kt&&this.props.metar.wind_gust_kt._text>30&&e.push(r.a.createElement("i",{key:t+2,className:"fas fa-exclamation-triangle"})),r.a.createElement("p",{id:this.props.metar.station_id,className:"icon is-small has-text-warning"},e)}}]),t}(r.a.Component),b=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(o.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).sendAirportData=function(){a.props.updateSelectedAirport(a.props.metar)},a}return Object(u.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"tile is-parent has-text-centered",onClick:this.sendAirportData},r.a.createElement("article",{className:"tile is-child box notification ".concat(this.props.flight_category),style:{padding:"0 5px 5px 0"}},r.a.createElement("p",{className:"title is-4 has-text-centered",style:{marginBottom:"5px"}}," ",this.props.id," "),r.a.createElement(f,{metar:this.props.metar})))}}]),t}(r.a.Component),g=function(e){function t(){return Object(c.a)(this,t),Object(o.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(m.a)(t,[{key:"flightCategoryToCSS",value:function(e){return"VFR"===e?"is-success":"MVFR"===e?"is-info":"IFR"===e?"is-danger":"LIFR"===e?"is-lifr":"unknown-"+e}},{key:"render",value:function(){var e=this,t=[];if(0===this.props.metars.length)return!1;this.props.metars.forEach((function(a,n){if(a){var s=Object.values(a.station_id),i=a.flight_category?e.flightCategoryToCSS(a.flight_category._text):"unknown-category",c=Object.values(a.raw_text),o=r.a.createElement(b,{key:s,id:s,flight_category:i,raw_text:c,updateSelectedAirport:e.props.updateSelectedAirport,metar:a});t.push(o)}}));for(var a=[],n=0;n<this.props.airportRows;n++){var s=n*this.props.airportsPerRow,i=s+this.props.airportsPerRow;a.push(t.slice(s,i))}return a.map((function(e,t){return r.a.createElement(h,{key:t},e)}))}}]),t}(r.a.Component),y=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(o.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).metarAgeTime=function(){var e=Math.floor((a.props.current_time-a.props.last_updated)/1e3);return Math.floor(e/60)+":"+Math.floor(e%60).toString().padStart(2,"0")},a}return Object(u.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"tile is-ancenstor"},r.a.createElement("div",{className:"tile is-parent is-12 has-text-grey-lighter",style:{marginTop:"0px",paddingTop:"0px"}},r.a.createElement("div",{className:"tile is-child"},r.a.createElement("div",{className:"is-pulled-right"},this.metarAgeTime()," old"))))}}]),t}(r.a.Component),v=function(e){function t(){return Object(c.a)(this,t),Object(o.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=null,t=[];if(this.props.selectedAirport){var a=this.props.selectedAirport.station_id._text;e=this.props.selectedAirport.raw_text._text;var n=this.props.airports[a].taf;n&&(t=n.raw_text._text.split(/(?=TEMPO|BECMG|FM|PROB)/))}else e="";return r.a.createElement("div",{className:"has-text-centered"},r.a.createElement("pre",null,r.a.createElement("p",null,e),r.a.createElement("p",null,t.join("\n"))))}}]),t}(r.a.Component),O=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).airportsPerRow=7,a.cycleDelay=1e4,a.afterClickCycleDelay=2e4,a.updateSelectedAirport=function(e){clearTimeout(a.state.airportCycleTimer);var t=setTimeout(a.cycleAirports,a.afterClickCycleDelay);a.setState({airportCycleTimer:t,selectedAirport:e})},a.cycleAirports=function(){if(!a.state.selectedAirport&&!a.props.metars)return setTimeout(a.cycleAirports,100),!1;var e=a.state.currentIndex>=a.props.metars.length-1?0:a.state.currentIndex+1;a.setState({currentIndex:e});var t=setTimeout(a.cycleAirports,a.cycleDelay);a.setState({airportCycleTimer:t,selectedAirport:a.props.metars[a.state.currentIndex]})},a.componentWillUnmount=function(){},a.state={selectedAirport:null,airportComponents:[],currentIndex:0,airportCycleTimer:null,currentTime:new Date},a}return Object(u.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;setInterval((function(){e.setState({currentTime:new Date})}),1e3),this.cycleAirports()}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(d,{current_time:this.state.currentTime}),r.a.createElement(g,{metars:this.props.metars,airportRows:this.props.metarCount/this.airportsPerRow,airportsPerRow:this.airportsPerRow,updateSelectedAirport:this.updateSelectedAirport}),r.a.createElement(y,{current_time:this.state.currentTime,last_updated:new Date(this.props.lastUpdated)}),r.a.createElement(v,{selectedAirport:this.state.selectedAirport,airports:this.props.airports}))}}]),t}(r.a.Component),j=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(o.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).componentDidMount=function(){console.log("Fetching logs")},a}return Object(u.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("pre",null,this.props.logLines.values))}}]),t}(r.a.Component),E=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).setLedState=function(){a.props.ws.send({leds:!a.state.ledState}),a.setState({ledState:!a.state.ledState})},a.ledStateString=function(){return!0===a.state.ledState?"Off":"On"},a.ledStateCssClass=function(){var e="button is-large ";return e+=!1===a.state.ledState?"is-success":"is-danger"},a.updateData=function(){a.props.ws.send({data:"update"})},a.state={ledState:!0},a}return Object(u.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("button",{className:this.ledStateCssClass(),onClick:this.setLedState},"Turn Lights ",this.ledStateString())),r.a.createElement("p",null,r.a.createElement("button",{className:"button is-large is-primary",onClick:this.updateData},"Update Data")))}}]),t}(r.a.Component),w=function e(t){var a=this;Object(c.a)(this,e),this.connectAndSubscribe=function(){a.connect(),a.registerCallbacks(),a.subscribe()},this.connect=function(){console.log("Opening WS to "+window.location.host),a.ws=new WebSocket("ws://"+window.location.host+"/metar.ws")},this.subscribe=function(){a.ws.onopen=function(){a.messageTypes.forEach((function(e){a.send({subscribe:e})}))}},this.registerCallbacks=function(){a.ws.onmessage=function(e){a.handleMessage(JSON.parse(e.data))},a.ws.onerror=function(e){console.log("An error occured: "),console.log(e)},a.ws.onclose=function(e){console.log("Connection closed"),a.attemptReconnect()}},this.attemptReconnect=function(){console.log("Reconnecting in ",a.reconnectTimeout," sec"),setTimeout((function(){a.connectAndSubscribe()}),1e3*a.reconnectTimeout)},this.send=function(e){a.ws.send(JSON.stringify(e))},this.handleMessage=function(e){switch(e.type){case"metars":console.log("RX METAR"),a.App.setState({airports:e.payload,metars:e.payload.metars.airports,metarCount:e.payload.metars.airports.length,lastUpdated:e.payload.metars.lastUpdated});break;case"logs":console.log("RX LOG"),a.App.setState({logLines:e.payload});break;default:console.log("Unknown message type: "+JSON.stringify(e))}},this.reconnectTimeout=2,this.App=t,this.messageTypes=["metars","logs"],this.connectAndSubscribe()},k=a(14),C=a(11),S=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).componentDidMount=function(){var e=new w(Object(p.a)(a));a.setState({ws:e,activeTab:"dashboard"})},a.isActive=function(e){if(e===a.state.activeTab)return"is-active"},a.makeActive=function(e){a.setState({activeTab:e})},a.render=function(){return r.a.createElement(k.a,null,r.a.createElement("div",{className:"tabs"},r.a.createElement("ul",null,r.a.createElement("li",{className:a.isActive("dashboard")},r.a.createElement(k.b,{onClick:function(){return a.makeActive("dashboard")},to:"/"},"Dashboard")),r.a.createElement("li",{className:a.isActive("logs")},r.a.createElement(k.b,{onClick:function(){return a.makeActive("logs")},to:"/logs"},"Logs")),r.a.createElement("li",{className:a.isActive("tools")},r.a.createElement(k.b,{onClick:function(){return a.makeActive("tools")},to:"/tools"},"Tools")))),r.a.createElement(C.c,null,r.a.createElement(C.a,{exact:!0,path:"/",render:function(e){return r.a.createElement(O,{ws:a.state.ws,airports:a.state.airports,metars:a.state.metars,metarCount:a.state.metarCount,lastUpdated:a.state.lastUpdated})}}),r.a.createElement(C.a,{path:"/logs"},r.a.createElement(j,{logLines:a.state.logLines})),r.a.createElement(C.a,{path:"/tools"},r.a.createElement(E,{ws:a.state.ws}))))},a.state={ws:null,airports:[],metars:[],metarCount:null,lastUpdated:null,logLines:[]},a}return Object(u.a)(t,e),t}(r.a.Component);i.a.render(r.a.createElement(S,null),document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.a4e85251.chunk.js.map